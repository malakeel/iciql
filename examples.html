<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<!-- Begin Header -->
<title>Iciql</title>
<meta charset="utf-8">
<meta name="ROBOTS" content="INDEX">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
<link rel="stylesheet" href="./bootstrap/css/bootstrap.css">
<link rel='shortcut icon' type='image/png' href='./iciql-favicon.png' />
<link rel="stylesheet" href="./prettify/googlecode.css" /><link rel="alternate" type="application/rss+xml" title="Iciql RSS 2.0" href="./rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Iciql Atom" href="./atom.xml" />

<!-- Google Plus One -->
<link rel="canonical" href="http://iciql.com" />
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<style type="text/css"> div.gplusone { margin-top:12px; } </style>

<script src="./prettify/prettify.js"></script>
<script src="./bootstrap/js/jquery.js"></script>
<script src="./bootstrap/js/bootstrap.min.js"></script>
</head>
<body onload='prettyPrint()'>		<!-- Navigation Bar -->
		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
          			<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            			<span class="icon-bar"></span>
            			<span class="icon-bar"></span>
            			<span class="icon-bar"></span>
          			</a>
          			<a class="brand" href="./"><img src="./iciql_white.png" alt="Iciql"></img></a>
					<div class="nav-collapse">
						<ul class="nav">
							<li class='dropdown'> <!-- Menu -->
<a class='dropdown-toggle' href='#' data-toggle='dropdown'>about<b class='caret'></b></a>
<ul class='dropdown-menu'>
<li><a href='index.html'>overview</a></li>
<li><a href='performance.html'>performance</a></li>
<li><a href='jaqu_comparison.html'>jaqu comparison</a></li>
</ul></li> <!-- End Menu -->
<li class='dropdown'> <!-- Menu -->
<a class='dropdown-toggle' href='#' data-toggle='dropdown'>getting started<b class='caret'></b></a>
<ul class='dropdown-menu'>
<li><a href='model_classes.html'>table model classes</a></li>
<li><a href='dta.html'>data type adapters (DTA)</a></li>
<li><a href='dao.html'>data access object (DAO) usage</a></li>
<li><a href='table_versioning.html'>database and table versioning</a></li>
<li class='divider'></li>
<li><a href='usage.html'>SQL DSL usage</a></li>
<li><a href='examples.html'>SQL DSL examples</a></li>
<li><a href='tools.html'>tools</a></li>
</ul></li> <!-- End Menu -->
<li><a href='building.html'>building</a></li>
<li><a href='javadoc.html'>javadoc</a></li>
<li><a href='releasenotes.html'>release notes</a></li>
<li class='dropdown'> <!-- Menu -->
<a class='dropdown-toggle' href='#' data-toggle='dropdown'>downloads<b class='caret'></b></a>
<ul class='dropdown-menu'>
<li><a href='http://gitblit.github.io/iciql/maven/com/iciql/iciql/1.6.1/iciql-1.6.1.zip'>iciql-1.6.1</a></li>
<li class='divider'></li>
<li><a href='http://gitblit.github.io/iciql/maven'>Maven Repository</a></li>
</ul></li> <!-- End Menu -->
<li class='dropdown'> <!-- Menu -->
<a class='dropdown-toggle' href='#' data-toggle='dropdown'>links<b class='caret'></b></a>
<ul class='dropdown-menu'>
<li><a href='https://github.com/gitblit/iciql'>Github</a></li>
<li><a href='https://github.com/gitblit/iciql/issues'>Issues</a></li>
<li><a href='http://gitblit.github.io/iciql/maven'>Maven Repository</a></li>
</ul></li> <!-- End Menu -->
<li class='divider-vertical'></li>
<li><div class='gplusone'><g:plusone size='small' href='http://iciql.com'></g:plusone></div></li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div><!-- end Navigation Bar -->
<div class='container'>
<!-- Begin Markdown -->
<h2 class="section" id='H1'><a href="#H1" class="sectionlink"><i class="icon-share-alt"> </i></a>SQL DSL Examples</h2><p>Here are some examples of using the Iciql SQL DSL.</p>
<h3 class="section" id='H2'><a href="#H2" class="sectionlink"><i class="icon-share-alt"> </i></a>Select Statements</h3><p><pre class='prettyprint lang-java'>
// select * from products
List&lt;Product&gt; allProducts = db.from(p).select();

// select * from customers where region='WA'
Customer c = new Customer();
List&lt;Customer&gt; waCustomers = db.from(c). where(c.region).is(&quot;WA&quot;).select();

public static class ProductPrice {
	public String productName;
	public String category;
	public Double price;
}

// select with generation of new anonymous inner class
List&lt;ProductPrice&gt; productPrices =
    db.from(p).
    orderBy(p.productId).
    select(new ProductPrice() {{
        productName = p.productName;
        category = p.category;
        price = p.unitPrice;
    }});
</pre></p>
<h3 class="section" id='H3'><a href="#H3" class="sectionlink"><i class="icon-share-alt"> </i></a>Insert Statements</h3><p><pre class='prettyprint lang-java'>
// single record insertion
db.insert(singleProduct);

// single record insertion with primary key retrieval
Long key = db.insertAndGetKey(singleProduct);

// batch record insertion
db.insertAll(myProducts);

// batch insertion with primary key retrieval
List&lt;Long&gt; myKeys = db.insertAllAndGetKeys(list);
</pre></p>
<h3 class="section" id='H4'><a href="#H4" class="sectionlink"><i class="icon-share-alt"> </i></a>Update Statements</h3><p><pre class='prettyprint lang-java'>
// single record update
db.update(singleProduct);

// batch record updates
db.updateAll(myProducts);

// update query
db.from(p).set(p.productName).to(&quot;updated&quot;)
	.increment(p.unitPrice).by(3.14)
	.increment(p.unitsInStock).by(2)
	.where(p.productId).is(1).update();
	
// reusable, parameterized update query
String q = db.from(p).set(p.productName).toParameter().where(p.productId).is(1).toSQL();
db.executeUpdate(q, &quot;Lettuce&quot;);
</pre></p>
<h3 class="section" id='H5'><a href="#H5" class="sectionlink"><i class="icon-share-alt"> </i></a>Upsert/Merge Statements</h3><p>The Upsert or Merge methods will insert a new object if the primary key does not already exist or will update the record for the primary key.</p><p><pre class='prettyprint lang-java'>
Product pChang = db.from(p).where(p.productName).is(&quot;Chang&quot;).selectFirst();
pChang.unitPrice = 19.5;
pChang.unitsInStock = 16;
db.merge(pChang);
</pre></p>
<h3 class="section" id='H6'><a href="#H6" class="sectionlink"><i class="icon-share-alt"> </i></a>Delete Statements</h3><p><pre class='prettyprint lang-java'>
// single record deletion
db.delete(singleProduct);  

// batch record deletion
db.deleteAll(myProducts);

// delete query
db.from(p).where(p.productId).atLeast(10).delete();
</pre></p>
<h3 class="section" id='H7'><a href="#H7" class="sectionlink"><i class="icon-share-alt"> </i></a>Inner Join Statements</h3><p><pre class='prettyprint lang-java'>
final Customer c = new Customer();
final Order o = new Order();

List&lt;Customer&gt; customersWithLargeOrders =
    db.from(c).
    innerJoin(o).on(c.customerId).is(o.customerId).
    where(o.total).greaterThan(new BigDecimal(&quot;500.00&quot;)).
    groupBy(c.customerId).select();

List&lt;CustOrder&gt; orders =
    db.from(c).
    innerJoin(o).on(c.customerId).is(o.customerId).
    where(o.total).lessThan(new BigDecimal(&quot;500.00&quot;)).
    orderBy(1).
    select(new CustOrder() {{
        customerId = c.customerId;
        orderId = o.orderId;
        total = o.total;
    }});
</pre></p>
<h3 class="section" id='H8'><a href="#H8" class="sectionlink"><i class="icon-share-alt"> </i></a>View Statements</h3><p><pre class='prettyprint lang-java'>
// the view named &quot;ProductView&quot; is created from the &quot;Products&quot; table
@IQView(viewTableName = &quot;Products&quot;)
public class ProductView {

    @IQColumn
    @IQConstraint(&quot;this &gt;= 200 AND this &lt; 300&quot;)
    Long id;
	
    @IQColumn
    String name;
}

final ProductView v = new ProductView();
List&lt;ProductView&gt; allProducts = db.from(v).select();

// this version of the view model &quot;ProductView&quot; inherits table metadata
// from the Products class which is annotated with IQTable
@IQView(inheritColumns = true)
public class ProductView extends Products {

    // inherited BUT replaced to define the constraint
    @IQColumn
    @IQConstraint(&quot;this &gt;= 200 AND this &lt; 300&quot;)
    Long id;
	
    // inherited from Products
    //@IQColumn
    //String name;
}

final ProductView v = new ProductView();
List&lt;ProductView&gt; allProducts = db.from(v).select();

// in this example we are creating a view based on a fluent query
// and using 2 levels of inheritance.  IQConstraints are ignored
// when using this approach because we are fluently defining them.
@IQView(inheritColumns = true)
public class ProductViewInherited extends ProductView {

}

final Products p = new Products();
db.from(p).where(p.id).atLeast(200L).and(p.id).lessThan(300L).createView(ProductViewInherited.class);

// now replace the view with a variation
db.from(p).where(p.id).atLeast(250L).and(p.id).lessThan(350L).replaceView(ProductViewInherited.class);

// now drop the view from the database
db.dropView(ProductViewInherited.class);
</pre></p>
<h3 class="section" id='H9'><a href="#H9" class="sectionlink"><i class="icon-share-alt"> </i></a>Dynamic Queries</h3><p>Dynamic queries skip all field type checking and, depending on which approach you use, may skip model class/table name checking too.</p><p><pre class='prettyprint lang-java'>
// where fragment with object parameters
List&lt;Product&gt; restock = db.from(p).where(&quot;unitsInStock=? and productName like ? order by productId&quot;, 0, &quot;Chef%&quot;).select();

// parameterized query which can be cached and re-used later
String q = db.from(p).where(p.unitsInStock).isParameter().and(p.productName).likeParameter().orderBy(p.productId).toSQL();
List&lt;Product&gt; allProducts = db.executeQuery(Product.class, q, 0, &quot;Chef%&quot;);

// statement with binding to your model class
List&lt;Product&gt; allProducts = db.executeQuery(Product.class, &quot;select * from products&quot;);

// statement with object parameters and binding to your model class
List&lt;Product&gt; restock = db.executeQuery(Product.class, &quot;select * from products where unitsInStock=?&quot;, 0);

/**
 * If you want to process the intermediate ResultSet
 * yourself make sure to use the &lt;i&gt;closeSilently()&lt;/i&gt; method 
 * to ensure the parent statement is closed too.
 */
ResultSet rs = db.executeQuery(&quot;select * from products&quot;);
List&lt;Product&gt; allProducts = db.buildObjects(Product.class, rs);
JdbcUtils.closeSilently(rs, true);
</pre>
<!-- End Markdown -->
<div ><ul class="pager"><li class="previous"><a href="usage.html">&larr; SQL DSL usage</a></li> <li class="next"><a href="tools.html">tools &rarr;</a></li></ul></div><footer class="footer"><p class="pull-right">generated 2015-05-11</p>
<p>The content of this page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0">Creative Commons Attribution 3.0 License</a>.</p>
</footer>
</div>
</body>
</html>